// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i=function(e,t){return function(){return e.apply(t,arguments)}};n=function(){function e(){this.handleHvSwitch=i(this.handleHvSwitch,this);this.setupHvPicker=i(this.setupHvPicker,this);this.setupHvPicker()}e.prototype.setupHvPicker=function(){var e;e=$("#hv-picker");this.current=e.find(".vertical");e.on("click","button",this.handleHvSwitch);return this.current.trigger("click")};e.prototype.handleHvSwitch=function(e){var t;e.preventDefault();t=$(e.currentTarget);if(t.hasClass("current"))return;t.siblings().removeClass("current");t.addClass("current");this.layout=t.data("layout");return $("body").trigger("optionChange")};return e}();t=function(){function e(e,t){var n=this;this.cssifier=e;this.options=t;this.updateSprite=i(this.updateSprite,this);this.updateBoth=i(this.updateBoth,this);this.addFile=i(this.addFile,this);this.files=[];this.canvas=$("<canvas>")[0];this.ctx=this.canvas.getContext("2d");this.previewImage=$("#preview-container").find("img");$("body").on("optionChange",function(){if(n.files.length)return n.updateBoth()})}e.prototype.addFile=function(e){this.files.push(e);return this.updateBoth()};e.prototype.updateBoth=function(){this.updateSprite();return this.cssifier.cssify(this.files)};e.prototype.updateSprite=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;s=this.options.layout;o=0;e=0+o;l=0;u=0;f=0;a=0;s==="v"?a+=o:f+=o;this.canvas.width=this.canvas.width;v=this.files;for(c=0,p=v.length;c<p;c++){t=v[c];i=new Image;i.src=t.data;r=t.size.width;n=t.size.height;r>l&&(l=r);n>u&&(u=n);if(s==="v"){t.offset={left:0,top:a};f=l;a+=n+o}else{t.offset={left:f,top:0};f+=r+o;a=u}}this.canvas.width=f;this.canvas.height=a;s==="v"?this.previewImage.css({maxWidth:"auto",maxHeight:"100%"}):this.previewImage.css({maxWidth:"100%",maxHeight:"auto"});m=this.files;for(h=0,d=m.length;h<d;h++){t=m[h];i=new Image;i.src=t.data;r=i.width;n=i.height;s==="v"?this.ctx.drawImage(i,0,e):this.ctx.drawImage(i,e,0);e+=(s==="v"?n:r)+o}return this.previewImage.attr("src",this.canvas.toDataURL())};return e}();r=function(){function e(e){this.generator=e;this.processFile=i(this.processFile,this);this.handleDrop=i(this.handleDrop,this);this.handleDragLeave=i(this.handleDragLeave,this);this.handleDragOver=i(this.handleDragOver,this);this.handleDragEnter=i(this.handleDragEnter,this);this.initializeTarget=i(this.initializeTarget,this);this.initializePreviewImage=i(this.initializePreviewImage,this);this.initializeTarget();this.initializePreviewImage();this.dragReady=!0;this.processing=!1}e.prototype.initializePreviewImage=function(){var e,t=this;e=this.target.find("#preview");e.on("dragstart",function(){return setTimeout(function(){return t.dragReady=!1},1)});return e.on("dragend",function(){return t.dragReady=!0})};e.prototype.initializeTarget=function(){this.target=$("#preview-container");this.collection=$();this.target.on("dragenter",this.handleDragEnter);this.target.on("dragover",this.handleDragOver);this.target.on("dragleave",this.handleDragLeave);return this.target.on("drop",this.handleDrop)};e.prototype.handleDragEnter=function(e){if(this.dragReady){this.collection.size()||this.target.addClass("drag-over");return this.collection=this.collection.add(e.target)}};e.prototype.handleDragOver=function(e){return e.preventDefault()};e.prototype.handleDragLeave=function(e){var t=this;return setTimeout(function(){t.collection=t.collection.not(e.target);if(!t.collection.size())return t.target.removeClass("drag-over")},0)};e.prototype.handleDrop=function(e){var t,n,r,i;e.stopPropagation();e.preventDefault();this.target.addClass("dropped");this.collection=$();this.target.removeClass("drag-over");i=e.originalEvent.dataTransfer.files;for(n=0,r=i.length;n<r;n++){t=i[n];this.processFile(t)}return!1};e.prototype.processFile=function(e){var t,n=this;if(this.processing)return setTimeout(function(){return n.processFile(e)},30);this.processing=!0;if(!e.type.match(/^image\/(png|jpg|jpeg|gif)$/)){alert("GIF, PNG, and JPG only.");return}t=new FileReader;t.addEventListener("load",function(t){var r,i;r=t.target.result;i=new Image;i.src=r;return $(i).on("load",function(){n.generator.addFile({rawName:e.name,name:e.name.substr(0,e.name.lastIndexOf(".")),data:r,size:{width:i.width,height:i.height}});return n.processing=!1})});return t.readAsDataURL(e)};return e}();e=function(){function e(){this.cssify=i(this.cssify,this);this.handleTextareaFocus=i(this.handleTextareaFocus,this);$("#css-container").find("textarea").on("focus",this.handleTextareaFocus)}e.prototype.handleTextareaFocus=function(e){return setTimeout(function(){return $(e.currentTarget).select()},0)};e.prototype.cssify=function(e){var t,n,r,i,s;r="sprite";t="."+r+' { background: url("'+r+'.png"); }\n';for(i=0,s=e.length;i<s;i++){n=e[i];t+="."+r+"."+n.name+" { background-position: -"+n.offset.left+"px -"+n.offset.top+"px; width: "+n.size.width+"px; height: "+n.size.height+"px; }\n"}return $("#css-container").find("textarea").html(t)};return e}();$(document).ready(function(){var i,s,o,u;if(typeof window.FileReader=="undefined"){alert("Your browser doesn't have FileReader support. Now's a great time to try Chrome!");return}o=new n;i=new e;s=new t(i,o);return u=new r(s)})}).call(this);